<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Climate App</title>
</head>

<body onload="onLoad()">

    <main>
        <div style="margin: 10px; position: relative;">
            <img src="https://www.open.edu/openlearn/pluginfile.php/101161/mod_oucontent/oucontent/890/639dcd57/4078d39e/s250_3_011i.jpg"
                width="1000" alt="climate graphic" />
            <div style="position: absolute; left: 200px; top: 50px;">
                <div style="text-align: center; width: 100%;"><span id="value-sun">?</span> Wm<sup>-2</sup></div>
                <input type="range" min="100" max="400" value="100" class="slider" id="slider-sun"
                    oninput="onSliderInput(this)"><br />
                <label for="slider-sun">Intercepted solar radiation</label>
            </div>
            <div style="position: absolute; left: 80px; top: 300px;">
                <div id="value-cloud-albedo" style="text-align: center; width: 100%;"></div>
                <input type="range" min="0" max="100" value="22" class="slider" id="slider-cloud-albedo"
                    oninput="onSliderInput(this)"><br />
                <label for="slider-cloud-albedo">Cloud albedo</label>
            </div>
            <div style="position: absolute; left: 300px; top: 320px;">
                <div id="value-absorbed-by-atmosphere" style="text-align: center; width: 100%;"></div>
                <input type="range" min="0" max="100" value="20" class="slider" id="slider-absorbed-by-atmosphere"
                    oninput="onSliderInput(this)"><br />
                <label for="slider-absorbed-by-atmosphere">Absorbed by atmoshpere</label>
            </div>
            <div style="position: absolute; left: 80px; top: 500px;">
                <div id="value-surface-albedo" style="text-align: center; width: 100%;"></div>
                <input type="range" min="0" max="100" value="9" class="slider" id="slider-surface-albedo"
                    oninput="onSliderInput(this)"><br />
                <label for="slider-surface-albedo">Surface albedo</label>
            </div>
            <div style="position: absolute; left: 10px; top: 10px; width: 150px;">
                Reflected solar radiation escaping to space: <span id="reflected-solar-radiation">?</span>
                Wm<sup>-2</sup>
            </div>
            <div style="position: absolute; left: 250px; top: 500px; width: 150px;">
                Absorbed by surface: <span id="absorbed-by-surface">?</span> Wm<sup>-2</sup>
            </div>
            <div style="position: absolute; left: 400px; top: 600px;">
                GMST <span id="gmst">?</span> &#176;C
            </div>
            <div style="position: absolute; left: 750px; top: 500px; width: 150px;">
                Longwave radiation emitted by surface <span id="emitted-by-surface">?</span> Wm<sup>-2</sup>
            </div>
            <div style="position: absolute; left: 850px; top: 300px;">
                <div id="value-atmospheric-window" style="text-align: center; width: 100%;"></div>
                <input type="range" min="0" max="100" value="10" class="slider" id="slider-atmospheric-window"
                    oninput="onSliderInput(this)"><br />
                <label for="slider-atmospheric-window">Atmospheric window</label>
            </div>
            <div style="position: absolute; left: 800px; top: 50px; width: 150px;">
                Through window <span id="through-window">?</span> Wm<sup>-2</sup>
            </div>
            <div style="position: absolute; left: 650px; top: 300px; width: 150px;">
                Absorbed by greenhouse gases and clouds <span id="absorbed-by-ghg-clouds">?</span> Wm<sup>-2</sup>
            </div>
            <div style="position: absolute; left: 500px; top: 320px;">
                <div id="value-back-radiation" style="text-align: center; width: 100%;"></div>
                <input type="range" min="0" max="100" value="95" class="slider" id="slider-back-radiation"
                    oninput="onSliderInput(this)"><br />
                <label for="slider-back-radiation">Back radiation</label>
            </div>
            <div style="position: absolute; left: 500px; top: 500px; width: 150px;">
                Back radiation from atmosphere and clouds <span id="back-radiation">?</span> Wm<sup>-2</sup>
            </div>
            <div style="position: absolute; left: 500px; top: 10px; width: 150px;">
                Emitted by clouds and atmosphere into space <span id="emitted-to-space">?</span> Wm<sup>-2</sup>
            </div>
        </div>
    </main>

    <script>
        function onLoad() {
            initializeSliders();
            recompute();
        }

        function onSliderInput(slider) {
            setLabel(slider.id.replace("slider-", "value-"), parseFloat(slider.value));
            recompute();
        }

        function initializeSliders() {
            var sliders = document.getElementsByTagName('input');
            for (var i = 0; i < sliders.length; i++) {
                onSliderInput(sliders[i]);
            }
        }

        function recompute() {
            var solarInput = getSliderValue('slider-sun');
            var cloudAlbedo = getSliderValue('slider-cloud-albedo');
            var swAbsorbedByAtmosphere = getSliderValue('slider-absorbed-by-atmosphere');
            var surfaceAlbedo = getSliderValue('slider-surface-albedo');
            var reflected = ((cloudAlbedo + surfaceAlbedo) / 100) * solarInput;
            setLabel('reflected-solar-radiation', reflected);
            var swAbsorbedBySurface = solarInput - reflected - swAbsorbedByAtmosphere;
            setLabel('absorbed-by-surface', swAbsorbedBySurface);
            
            // var atmosphericWindow = getSliderValue('slider-atmospheric-window');
            // var throughWindow = (atmosphericWindow / 100) * emittedBySurface;
            // setLabel('through-window', throughWindow);
            var lwEmittedToSpace = solarInput - reflected;// - throughWindow;
            setLabel('emitted-to-space', lwEmittedToSpace);
            
            var backRadiationPercent = getSliderValue('slider-back-radiation');
            var backRadiationValue = getSliderValue('slider-back-radiation');
            setLabel('back-radiation', backRadiationValue);
            var lwEmittedBySurface = swAbsorbedBySurface + backRadiationValue;
            setLabel('emitted-by-surface', lwEmittedBySurface);
            var lwAbsorbedByGhgClouds = lwEmittedBySurface
            setLabel('absorbed-by-ghg-clouds', lwAbsorbedByGhgClouds);
            var boltzmannConstant = 5.6704E-8;
            var gmst = toCelsius(Math.pow(lwEmittedBySurface / boltzmannConstant, 0.25));
            setLabel('gmst', gmst);
        }

        function getSliderValue(id) {
            return parseFloat(document.getElementById(id).value);
        }

        function setLabel(id, value) {
            document.getElementById(id).innerText = value.toFixed(0);
        }

        function toCelsius(kelvin) {
            return kelvin - 273.15;
        }
    </script>

</body>

</html>